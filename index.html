<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Французские слова — Firestore</title>
<style>
  :root{
    --bg:#f7f8fb; --card:#ffffff; --accent:#3b82f6; --muted:#6b7280;
    --success:#16a34a; --danger:#dc2626; --radius:12px; 
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%; margin:0; background:var(--bg); color:#111}
  .wrap{max-width:900px; margin:18px auto; padding:18px; box-sizing:border-box;}
  header{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:16px;}
  h1{font-size:18px; margin:0}
  .controls{display:flex; gap:8px; flex-wrap:wrap;}
  button{background:var(--accent); color:#fff; border:0; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600}
  button.ghost{background:transparent; color:var(--accent); border:1px solid rgba(59,130,246,.16)}
  main{display:grid; grid-template-columns:1fr 360px; gap:16px;}
  @media (max-width:820px){ main{grid-template-columns:1fr;}}
  .card{background:var(--card); border-radius:var(--radius); padding:14px; box-shadow:0 6px 18px rgba(15,23,42,0.06);}
  form {display:flex; gap:8px; flex-direction:column;}
  input[type="text"]{padding:10px; border-radius:8px; border:1px solid #e6e9ef; width:100%; box-sizing:border-box;}
  .list{display:flex; flex-direction:column; gap:8px; max-height:60vh; overflow:auto; padding-right:6px;}
  .word-item{display:flex; justify-content:space-between; gap:8px; padding:10px; border-radius:10px; background:#fbfdff; border:1px solid #eef2ff; align-items:center;}
  .word-text{font-weight:600}
  .word-sub{font-size:13px; color:var(--muted)}
  .small{font-size:13px; color:var(--muted)}
  .train-word{font-size:28px; font-weight:700; margin:8px 0;}
  .result{font-weight:700; margin-top:8px;}
  .next{margin-top:8px}
  footer{margin-top:18px; font-size:13px; color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Французские слова — тренажёр</h1>
    <div class="controls">
      <button id="btn-add" class="ghost">Добавить</button>
      <button id="btn-list" class="ghost">Список</button>
      <button id="btn-train">Тренировка</button>
    </div>
  </header>

  <main>
    <!-- Left: main area (add / train / list shown here) -->
    <section id="main-area" class="card">
      <!-- ADD -->
      <div id="view-add">
        <h2 style="margin:0 0 8px 0">Добавить слово</h2>
        <form id="form-add" onsubmit="return false;">
          <input id="word" type="text" placeholder="Французское слово" autocomplete="off" />
          <input id="translation" type="text" placeholder="Перевод" autocomplete="off" />
          <div style="display:flex; gap:8px;">
            <button id="saveBtn" type="button">Сохранить</button>
            <button id="clearBtn" type="button" class="ghost">Очистить</button>
          </div>
          <p class="small">Данные хранятся в Google Firestore вашего проекта.</p>
        </form>
      </div>

      <!-- LIST -->
      <div id="view-list" style="display:none;">
        <h2 style="margin:0 0 8px 0">Сохранённые слова</h2>
        <div id="list" class="list"></div>
        <p class="small">Обнови страницу или нажми кнопку "Список" для перезагрузки.</p>
      </div>

      <!-- TRAIN -->
      <div id="view-train" style="display:none;">
        <h2 style="margin:0 0 8px 0">Тренировка</h2>
        <p class="small">Переведи слово:</p>
        <div class="train-word" id="train-word"></div>

        <input id="answer" type="text" placeholder="Введите перевод" autocomplete="off" />
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button id="checkBtn">Проверить</button>
          <button id="skipBtn" class="ghost">Пропустить</button>
        </div>

        <div id="result" class="result"></div>
        <button id="nextBtn" style="display:none;" class="next ghost">Следующее</button>
      </div>
    </section>

    <!-- Right column: краткая справка -->
    <aside class="card" style="height:fit-content;">
      <h3 style="margin:0 0 8px 0">Информация</h3>
      <p class="small">Мобильная адаптация и аккуратная верстка. Не храните приватные ключи в публичных файлах.</p>
      <hr/>
      <p class="small"><b>Состояние:</b> <span id="auth-status">...подключение...</span></p>
      <p class="small"><b>Всего слов:</b> <span id="count">0</span></p>
    </aside>
  </main>

  <footer>
    <p>Инструкции по настройке Firestore — ниже в инструкции.</p>
  </footer>
</div>

<!-- Firebase modular SDK через CDN (используем ES modules) -->
<script type="module">
/* ========== ЗАМЕНИТЕ ЭТО НА СВОЙ FIREBASE CONFIG ========== 
смотрите: Firebase Console → Project Settings → Your apps → Firebase SDK snippet (config)
=========================================================== */
const firebaseConfig = {
  apiKey: "AIzaSyAzqQNObcGY_Lu_QyEMWUTZhRhfeHUDVX8",
  authDomain: "words-8ae65.firebaseapp.com",
  projectId: "words-8ae65",
  storageBucket: "words-8ae65.firebasestorage.app",
  messagingSenderId: "908735400224",
  appId: "1:908735400224:web:c631c74fa4b0cf21cf6f45",
  measurementId: "G-JJ7353D81D"
};

/* ========== Импорты из CDN (modular SDK) ========== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

/* ========== Инициализация ========== */
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* ========== DOM refs ========== */
const btnAdd = document.getElementById('btn-add');
const btnList = document.getElementById('btn-list');
const btnTrain = document.getElementById('btn-train');

const viewAdd = document.getElementById('view-add');
const viewList = document.getElementById('view-list');
const viewTrain = document.getElementById('view-train');

const listEl = document.getElementById('list');
const countEl = document.getElementById('count');
const authStatusEl = document.getElementById('auth-status');

const formAdd = document.getElementById('form-add');
const inputWord = document.getElementById('word');
const inputTranslation = document.getElementById('translation');
const saveBtn = document.getElementById('saveBtn');
const clearBtn = document.getElementById('clearBtn');

const trainWordEl = document.getElementById('train-word');
const answerEl = document.getElementById('answer');
const checkBtn = document.getElementById('checkBtn');
const skipBtn = document.getElementById('skipBtn');
const resultEl = document.getElementById('result');
const nextBtn = document.getElementById('nextBtn');

/* ========== UI переключение видов ========== */
function showView(name){
  viewAdd.style.display = name==='add' ? '' : 'none';
  viewList.style.display = name==='list' ? '' : 'none';
  viewTrain.style.display = name==='train' ? '' : 'none';
  if(name==='list') loadWords();
}

/* кнопки */
btnAdd.addEventListener('click', ()=> showView('add'));
btnList.addEventListener('click', ()=> showView('list'));
btnTrain.addEventListener('click', ()=> startTraining());

/* очистка формы */
clearBtn.addEventListener('click', ()=>{
  inputWord.value=''; inputTranslation.value='';
});

/* ========== Firestore: коллекция слов ========== */
const WORDS_COLLECTION = 'words'; // имя коллекции в Firestore

/* ========== CRUD — добавить слово ========== */
saveBtn.addEventListener('click', async ()=>{
  const word = inputWord.value.trim();
  const translation = inputTranslation.value.trim();
  if(!word || !translation){ alert('Заполните оба поля'); return; }

  // сохраняем документ { word, translation, createdAt }
  try{
    await addDoc(collection(db, WORDS_COLLECTION), { word, translation, createdAt: Date.now() });
    inputWord.value=''; inputTranslation.value='';
    await loadWords();
    alert('Сохранено');
  }catch(err){
    console.error(err);
    alert('Ошибка при сохранении: '+(err.message||err));
  }
});

/* ========== Загрузка списка ========== */
async function loadWords(){
  try{
    const snap = await getDocs(collection(db, WORDS_COLLECTION));
    const items = [];
    snap.forEach(doc => items.push({ id: doc.id, ...doc.data() }));
    // сортируем по дате (если есть)
    items.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0));
    listEl.innerHTML = '';
    items.forEach(it=>{
      const div = document.createElement('div');
      div.className = 'word-item';
      div.innerHTML = `
        <div>
          <div class="word-text">${escapeHtml(it.word)}</div>
          <div class="word-sub">${escapeHtml(it.translation)}</div>
        </div>
        <div class="small">${new Date(it.createdAt||Date.now()).toLocaleString()}</div>
      `;
      listEl.appendChild(div);
    });
    countEl.textContent = items.length;
  }catch(err){
    console.error(err);
    alert('Ошибка при загрузке списка: '+(err.message||err));
  }
}

/* ========== Тренировка (логика аналогична вашей) ========== */
let trainWords = [];
let currentIndex = 0;

async function startTraining(){
  // подгружаем все слова
  try{
    const snap = await getDocs(collection(db, WORDS_COLLECTION));
    trainWords = [];
    snap.forEach(doc => trainWords.push(doc.data()));
    if(trainWords.length===0){ alert('Нет слов для тренировки'); return; }
    shuffle(trainWords);
    currentIndex = 0;
    showView('train');
    loadTrainingWord();
  }catch(err){
    console.error(err);
    alert('Ошибка: '+(err.message||err));
  }
}

function loadTrainingWord(){
  const w = trainWords[currentIndex];
  trainWordEl.textContent = w.word || '';
  answerEl.value = '';
  resultEl.textContent = '';
  nextBtn.style.display = 'none';
}

checkBtn.addEventListener('click', ()=>{
  const ans = answerEl.value.trim().toLowerCase();
  const correct = (trainWords[currentIndex].translation||'').toLowerCase();
  if(ans === correct){
    resultEl.textContent = '✔ Правильно!';
    resultEl.style.color = 'var(--success)';
  } else {
    resultEl.innerHTML = `✘ Неправильно. Правильный перевод: <b>${escapeHtml(correct)}</b>`;
    resultEl.style.color = 'var(--danger)';
  }
  nextBtn.style.display = '';
});

skipBtn.addEventListener('click', ()=>{
  resultEl.textContent = '';
  nextBtn.style.display = '';
});

nextBtn.addEventListener('click', ()=>{
  currentIndex++;
  if(currentIndex >= trainWords.length){
    trainWordEl.textContent = '';
    resultEl.textContent = 'Тренировка завершена!';
    nextBtn.style.display = 'none';
    return;
  }
  loadTrainingWord();
});

/* ========== Утилиты ========== */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]]=[arr[j], arr[i]];
  }
}
function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* ========== Анонимная аутентификация (рекомендуется) ========== */
authStatusEl.textContent = 'Подключаюсь...';
signInAnonymously(auth).catch(err=>{
  // может быть запрещено в консоли — сообщим
  console.warn('signInAnonymously error', err);
});

// слежение за изменениями статуса аутентификации
onAuthStateChanged(auth, user=>{
  if(user){
    authStatusEl.textContent = 'авторизован (anon)';
  } else {
    authStatusEl.textContent = 'неавторизован';
  }
});

/* показываем начальный вид */
showView('add');

</script>
</body>
</html>

